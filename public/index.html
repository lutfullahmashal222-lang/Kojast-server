<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ú©Ø¬Ø§Ø³Øª</title>

<style>
body{font-family:sans-serif;background:#f2f2f2;padding:15px}
input,select,button{width:100%;padding:10px;margin:5px}
.card{background:#fff;padding:10px;margin:10px 0;border-radius:10px}
img{width:100%;border-radius:10px}
iframe{width:100%;height:200px}
</style>
</head>
<body>

<h2>ÙˆØ±ÙˆØ¯</h2>

<input id="phone" placeholder="Ø´Ù…Ø§Ø±Ù‡">
<input id="pass" placeholder="Ø±Ù…Ø²">
<button onclick="login()">ÙˆØ±ÙˆØ¯</button>

<hr>

<h2>Ø«Ø¨Øª Ø¯Ú©Ø§Ù†</h2>

<input id="name" placeholder="Ù†Ø§Ù… Ø¯Ú©Ø§Ù†">
<input id="city" placeholder="Ø´Ù‡Ø±">

<select id="category">
<option>Ø¯ÙˆØ§Ø®Ø§Ù†Ù‡</option>
<option>Ø¯Ú©ØªØ±</option>
<option>Ø´ÙØ§Ø®Ø§Ù†Ù‡</option>
<option>Ù…Ø§Ø±Ú©ÛŒØª</option>
</select>

<input id="phone2" placeholder="ØªÙ…Ø§Ø³">
<input id="whatsapp" placeholder="ÙˆØ§ØªØ³Ø§Ù¾">

<input type="file" id="image">

<button onclick="getLocation()">Ú¯Ø±ÙØªÙ† Ù„ÙˆÚ©ÛŒØ´Ù†</button>
<button onclick="save()">Ø«Ø¨Øª</button>

<hr>

<h2>Ø¬Ø³ØªØ¬Ùˆ</h2>
<input id="searchCity" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ø´Ù‡Ø±">
<button onclick="load()">Ø¬Ø³ØªØ¬Ùˆ</button>

<div id="list"></div>

<input id="adminPass" placeholder="Ø±Ù…Ø² Ù…Ø¯ÛŒØ±">

<script>

let lat=0,lng=0;

function login(){
fetch("/api/login",{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
phone:phone.value,
password:pass.value
})
}).then(()=>alert("ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚"));
}

function getLocation(){
navigator.geolocation.getCurrentPosition(pos=>{
lat=pos.coords.latitude;
lng=pos.coords.longitude;
alert("Ù„ÙˆÚ©ÛŒØ´Ù† Ø«Ø¨Øª Ø´Ø¯");
});
}

function save(){

let form=new FormData();

form.append("name",name.value);
form.append("city",city.value);
form.append("category",category.value);
form.append("phone",phone2.value);
form.append("whatsapp",whatsapp.value);
form.append("lat",lat);
form.append("lng",lng);

form.append("image",image.files[0]);

fetch("/api/shops",{
method:"POST",
body:form
}).then(()=>load());
}

function load(){

fetch("/api/shops")
.then(r=>r.json())
.then(data=>{

let cityFilter=searchCity.value.toLowerCase();

let html="";

data
.filter(s=>s.city.toLowerCase().includes(cityFilter))
.forEach(s=>{

html+=`
<div class="card">

<img src="${s.image}">

<h3>${s.name}</h3>
ğŸ“ ${s.city} â€” ${s.category}<br>

ğŸ“ <a href="tel:${s.phone}">${s.phone}</a><br>
ğŸ’¬ <a href="https://wa.me/${s.whatsapp}">ÙˆØ§ØªØ³Ø§Ù¾</a>

<iframe src="https://maps.google.com/maps?q=${s.lat},${s.lng}&z=15&output=embed"></iframe>

<button onclick="del(${s.id})">Ø­Ø°Ù</button>

</div>
`;

});

list.innerHTML=html;

});
}

function del(id){

fetch("/api/shops/"+id,{
method:"DELETE",
headers:{password:adminPass.value}
}).then(()=>load());

}

load();

</script>

</body>
  </html>
